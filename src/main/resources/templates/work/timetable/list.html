<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorator="layout/template">
<head>
<meta charset="UTF-8">
<title>전체 시간표 관리</title>
<link rel="stylesheet" type="text/css" th:href="@{css/spectrum/spectrum.css}">
</head>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<body>

				
   <th:block layout:fragment="content">
      <main class="content">
         <div class="container-fluid p-0">
            <h1 class="h3 mb-3">월간 시간표</h1>
            <div class="row">
               <div class="col-12">
                  <div class="card">
                     <div class="card-header">
                        <div class="row">
							<div class="col-sm-12 col-md-6"></div>
							<div class="col-sm-12 col-md-6">
								<div id="datatables-buttons_filter" class="dataTables_filter">
											<button id="testBtn" class="btn">모달 테스트</button>
								</div>
							</div>
						</div>
                     </div>
                     <div class="card-body">
                        <div id="datatables-buttons_wrapper"
                           class="dataTables_wrapper dt-bootstrap4 no-footer">
                           
                           <div class="row">
                              <div class="col-sm-12 col-md-6"></div>
                              <div class="col-sm-12 col-md-6">
                              </div>
                           </div>
                           <div id="fullcalendar"></div>
                        </div>
                     </div>
                  </div>
                  
                  <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered" role="document">
						<div class="modal-content">
						
							<div class="modal-header">
								<h5 class="modal-title"><div id="time"></h5>
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				                     <span aria-hidden="true">&times;</span>
				                   </button>
							</div>
							
							<div class="modal-body m-3">
								<form id="addForm">
									<div class="form-group">
										<table id="datatables-buttons"
													class="table table-striped dataTable no-footer dtr-inline"
													style="width: 100%;" role="grid"
													aria-describedby="datatables-buttons_info">
													<thead>
													</thead>
													<tbody id="table_body">
														<tr role="row">
															<td>이름</td>
															<td>
																<select id='name' name='name' class='form-control'>
																	<option value="">임시1</option>
																</select>
															</td>
														</tr>
														<tr>
															<td>시간  </td>
															<td>
																<select id="startHour" name="startHour">
																	<option value="00">00</option>
																</select> 시 : <select id="startMin" name="startMin">
																	<option value="00">00</option>
																	<option value="10">10</option>
																	<option value="20">20</option>
																	<option value="30">30</option>
																	<option value="40">40</option>
																	<option value="50">50</option>
																</select> 분  ~ <select id="endHour" name="endHour">
																	<option value="00">00</option>
																</select> 시 : <select id="endMin" name="endMin">
																	<option value="00">00</option>
																	<option value="10">10</option>
																	<option value="20">20</option>
																	<option value="30">30</option>
																	<option value="40">40</option>
																	<option value="50">50</option>
																</select> 분 
															</td>
														</tr>
														<tr>
															<td>업무</td>
															<td>
																<select id='occupation' name='occupation'>
																	<option value="">서빙</option>
																	<option value="">배달</option>
																</select>
																<input type='text' id="occupation-color" name="color"/>
															</td>
														</tr>
													</tbody>
												</table>
											</div>
										</form>
										<div id="checkDupli"></div>
									</div>
							
							<div class="modal-footer">
								<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
								<button type="button" class="btn btn-primary" id="addBtn">시간표 등록</button>
							</div>
							
						</div>
					</div>
				</div>
                  
                  
               </div>
            </div>
         </div>
         
         
      </main>
   </th:block>
</body>
</html>
<script type="text/javascript" src="js/spectrum/spectrum.js"></script>
<script type='text/javascript' src="js/spectrum/toc.js"></script>
<script type='text/javascript' src="js/spectrum/docs.js"></script>
<script type="text/javascript" src="js/spectrum/prettify.js"></script> 
<script th:inline="javascript">
	 var branchNo = '';
	 var username = '';
	 
	$(function() {
		username = /*[[${#authentication.principal.username}]]*/ '';
		drawCalendar();
		
		$('#testBtn').click(function(e){
			e.preventDefault();
			$('#addModal').modal("show");
		});
		
		$('#selectBranchDiv').change(function () {
			branchNo = $('#selectBranchDiv').val();
			$("#fullcalendar").fullCalendar('destroy');
			drawCalendar();
		});
		
		$("#occupation-color").spectrum({
			  showPaletteOnly: true,
			  showPalette:true,
			  color: '#0070C0',
			  palette: [
			      ['#0070C0', '00B050', '#FFC000', '#7030A0', '#C00000'],
			      ['#4BACC6', '#9BBB59', '#F79646', '#C0504D', '#7F7F7F']
			  ]
		});
	});
	
	function drawCalendar() {
		$("#fullcalendar").fullCalendar({
			header : {
				left : "prev,next today",
				center : "title", 
			 	right : "month" 
			},
			weekNumbers : true,
			eventLimit : true,
			editable : false,
			displayEventEnd : true,
			events : function (start, end, timezone, callback) {
				$.ajax({
					url : "/timetable",
					type : "get",
					data : {
						branchNo : Number(branchNo)
					},
					datatype : "json",
					headers : {
						"Content-Type" : "application/json;charset=UTF-8"
					},
					success : function(data) {
						console.log("지점 변경 후 시간표 그리는 중 .. ");
						var events = [];
						for (i in data) {
							events.push({
					            title: "\n" + data[i].timetable.occupName + "\n" + data[i].schedule.name,
					            start: data[i].timetable.workStartTime,
					            end: data[i].timetable.workEndTime, 
					            color: data[i].timetable.occupColor,
					            textColor: "#ffffff"
					        });
						}
						callback(events);
					}, error : function(request, status, error) {
						console.log("Code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
					}
				});
			 },
			timeFormat: 'H:mm',
			eventClick:function (event) {
				alert(event.title);
				return false;
			},
			dayClick:function(date, jsEvent, view) {
				alert("Clicked on : " + date.format());
				return false;
			}
		});
	}
</script>